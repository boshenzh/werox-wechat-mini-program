<view class="page">
  <view class="card cover-card" wx:if="{{event}}">
    <view class="cover" style="background-image: url({{event.coverUrl}});">
      <view class="cover-badge">{{event.statusText}}</view>
    </view>
    <view class="cover-body">
      <text class="event-title">{{event.title}}</text>
      <text class="event-meta">{{event.dateText}} Â· {{event.location}}</text>
      <text class="event-desc">{{event.description}}</text>
      <view class="event-meta-row">
        <text class="meta-chip">äººæ•°ä¸Šé™ {{event.maxParticipants || 'ä¸é™'}}</text>
        <text class="meta-chip">è´¹ç”¨ {{event.price ? event.price + 'å…ƒ/äºº' : 'å…è´¹'}}</text>
      </view>
      <button class="primary-btn" bindtap="handleRegister">{{isFull ? 'æŠ¥åå·²æ»¡' : 'ç«‹å³æŠ¥å'}}</button>
    </view>
  </view>

  <view class="card info-card" wx:if="{{event && event.highlights.length}}">
    <text class="section-title">èµ›äº‹äº®ç‚¹</text>
    <view class="highlight-list">
      <view class="highlight-item" wx:for="{{event.highlights}}" wx:key="index">
        <text class="highlight-dot">â€¢</text>
        <text class="highlight-text">{{item}}</text>
      </view>
    </view>
  </view>

  <view class="card info-card" wx:if="{{event && event.posterUrl}}">
    <text class="section-title">èµ›äº‹æµ·æŠ¥</text>
    <image class="poster-img" src="{{event.posterUrl}}" mode="widthFix" />
  </view>

  <view class="card info-card">
    <view class="album-header">
      <text class="section-title">èµ›äº‹ç›¸å†Œ</text>
      <button class="primary-btn" bindtap="handleUpload">ä¸Šä¼ ç…§ç‰‡</button>
    </view>
    <text class="subtext">ç…§ç‰‡ä¼šåŒæ­¥åˆ°è¯¥èµ›äº‹ç›¸å†Œã€‚</text>
    <view class="empty-state-inline">
      <view class="empty-icon">ğŸ“·</view>
      <text class="subtext">æš‚æœªä¸Šä¼ ç…§ç‰‡</text>
    </view>
  </view>

  <view class="card info-card" wx:if="{{event}}">
    <view class="album-header">
      <text class="section-title">å‚èµ›é€‰æ‰‹</text>
      <text class="subtext">{{participants.length}} äºº</text>
    </view>
    <view class="participants-list" wx:if="{{participants.length > 0}}">
      <view class="participant-item" wx:for="{{showAllParticipants ? participants : displayParticipants}}" wx:key="_id">
        <image
          class="participant-avatar"
          src="{{item.avatarFileId}}"
          mode="aspectFill"
          wx:if="{{item.avatarFileId}}"
        />
        <view class="participant-avatar placeholder" wx:else>
          <text class="avatar-icon">ğŸ‘¤</text>
        </view>
        <view class="participant-info">
          <text class="participant-name">{{item.nickname}}</text>
          <text class="subtext">{{item.trainingFocus || 'è®­ç»ƒæ–¹å‘æœªå¡«å†™'}}</text>
          <text class="subtext">{{item.groupType || 'æŠ¥åç»„åˆ«æœªå¡«å†™'}}</text>
        </view>
      </view>
      <button class="view-more-btn" wx:if="{{!showAllParticipants && participants.length > 5}}" bindtap="toggleParticipants">
        æŸ¥çœ‹å…¨éƒ¨ ({{participants.length}}äºº)
      </button>
      <button class="view-more-btn" wx:if="{{showAllParticipants && participants.length > 5}}" bindtap="toggleParticipants">
        æ”¶èµ·åˆ—è¡¨
      </button>
    </view>
    <view class="empty-state-inline" wx:else>
      <view class="empty-icon">ğŸ‘¥</view>
      <text class="subtext">æš‚æ— æŠ¥åé€‰æ‰‹</text>
    </view>
  </view>

  <view class="empty-state-box" wx:if="{{!loading && !event}}">
    <view class="empty-state-icon">
      <text>ğŸ”</text>
    </view>
    <text class="empty-state-title">èµ›äº‹ä¸å­˜åœ¨</text>
    <text class="empty-state-desc">è¯¥èµ›äº‹å¯èƒ½å·²ä¸‹æ¶æˆ–ä¸å­˜åœ¨</text>
  </view>
</view>
